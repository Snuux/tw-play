(()=>{const DEFAULT_FORMAT_URL="https://cdn.jsdelivr.net/gh/tmedwards/sugarcube-2@v2.37.3/dist/format.js";const DEFAULT_EXTWEE_URL="https://cdn.jsdelivr.net/gh/videlais/extwee@v2.3.2/build/extwee.web.min.js";const qs=(sel,root=document)=>root.querySelector(sel);const loadScript=src=>new Promise((res,rej)=>{const s=document.createElement("script");s.src=src;s.onload=res;s.onerror=()=>rej(new Error("Load fail "+src));document.head.appendChild(s);});async function run(){const current=document.currentScript;const formatURL=current?.dataset?.format||DEFAULT_FORMAT_URL;const tweeSrc=current?.dataset?.src;let target=qs("#play");if(!target){target=document.createElement("iframe");target.id="play";target.setAttribute("sandbox","allow-scripts allow-same-origin");target.style.cssText="width:100%;height:100vh;border:0;";document.body.appendChild(target);}if(!window.Extwee)await loadScript(DEFAULT_EXTWEE_URL);let twee="";const inline=qs('script[type="text/twee"], script[type="text/plain"]#twee');if(inline)twee=inline.textContent.trim();else if(tweeSrc)twee=await(await fetch(tweeSrc,{cache:"no-store"})).text();else{document.body.insertAdjacentHTML("afterbegin",'<p style="color:red">No Twee found. Add <script type="text/twee">â€¦</script> or use data-src</p>');return;}const fmtText=await(await fetch(formatURL,{cache:"no-store"})).text();const sf=window.Extwee.parseStoryFormat(fmtText);const story=window.Extwee.parseTwee(twee);const html=await window.Extwee.compileTwine2HTML(story,sf);if(target.tagName==="IFRAME")target.srcdoc=html;else target.innerHTML=html;}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",run);else run();})();